import{w as S}from"./index.6e379fdf.js";import{a1 as d}from"./scheduler.a453f4b8.js";import{l as B}from"./ProgressBar.svelte_svelte_type_style_lang.c6c4a621.js";import"./index.fa05b556.js";const y="https://virtualpinballspreadsheet.github.io/vps-db/",T=y+"db/vpsdb.json";y+`lastUpdated.json?ts=${new Date().getTime()}`;const k="VirtualPinballSpreadsheet",L="vps-db",N="img/",C="games/",H="staging",I=["tableFiles","povFiles","b2sFiles","romFiles","altColorFiles","altSoundFiles","pupPackFiles","wheelArtFiles","topperFiles","mediaPackFiles","ruleFiles","tutorialFiles"],O=["Hybrid","VR","Mixed Reality","FSS","4k","MOD","Retheme","VPU Patch","FastFlips","SSF","P-ROC","FlexDMD","Music","incl. B2S","incl. ROM","incl. nvram","incl. Art","incl. PuP","incl. Video","no ROM","Kids","Adult","nFozzy","Fleep","VLM","LUT","Scorbit","BAM","FizX","DOF"],w=["2Screens","3Screens","FullDMD","incl. Table"],x=O.map(e=>({label:e,value:e})),z=w.map(e=>({label:e,value:e})),X={id:"",authors:[],tableFormat:"VPX",urls:[],updatedAt:0},U={id:"",updatedAt:0,manufacturer:"",name:"???",year:0},J={authors:[],id:"",updatedAt:0,urls:[]},Q={authors:[],id:"",updatedAt:0,title:"",youtubeId:"dQw4w9WgXcQ"},W={authors:[],id:"",updatedAt:0,urls:[]},n=S({}),A=S({}),v=B("lastUpdatedDb",0),_=async()=>{try{const e=await g(),i={};(await(await fetch(T+`?&ts=${new Date().getTime()}`)).json()).forEach(o=>{const l=o.id;i[l]=o}),v.set(e),console.log("SET DB STORE"),n.set(i),A.set(JSON.parse(JSON.stringify(i)))}catch(e){console.log(e)}},E=e=>{var t,o;const s=d(n)[e];if(s){if(s.imgUrl)return s.imgUrl;if((t=s.b2sFiles)!=null&&t.length&&s.b2sFiles[0].imgUrl)return s.b2sFiles[0].imgUrl;if((o=s.tableFiles)!=null&&o.length&&s.tableFiles[0].imgUrl)return s.tableFiles[0].imgUrl}},P=e=>{const i=d(n);if(i[e])return i[e];let s=U;return Object.values(i).forEach(t=>{var o,l,c,r,u,m,F,p,b,f,h,D;(o=t.tableFiles)!=null&&o.some(a=>a.id===e)&&(s=t),(l=t.b2sFiles)!=null&&l.some(a=>a.id===e)&&(s=t),(c=t.romFiles)!=null&&c.some(a=>a.id===e)&&(s=t),(r=t.povFiles)!=null&&r.some(a=>a.id===e)&&(s=t),(u=t.altColorFiles)!=null&&u.some(a=>a.id===e)&&(s=t),(m=t.altSoundFiles)!=null&&m.some(a=>a.id===e)&&(s=t),(F=t.pupPackFiles)!=null&&F.some(a=>a.id===e)&&(s=t),(p=t.wheelArtFiles)!=null&&p.some(a=>a.id===e)&&(s=t),(b=t.mediaPackFiles)!=null&&b.some(a=>a.id===e)&&(s=t),(f=t.topperFiles)!=null&&f.some(a=>a.id===e)&&(s=t),(h=t.soundFiles)!=null&&h.some(a=>a.id===e)&&(s=t),(D=t.ruleFiles)!=null&&D.some(a=>a.id===e)&&(s=t)}),s},R=e=>{var t,o;const i=d(n),s=i[e];if(s)return s;for(const l of Object.values(i))if(((t=l.romFiles)==null?void 0:t.find(r=>r.version===e))||(o=l.tableFiles)!=null&&o.some(r=>r.id===e))return l;return null},M=(e,i)=>{const s=d(n);for(const t of Object.values(s)){const o=t[i];if(Array.isArray(o)){const l=o.find(c=>c.id===e);if(l)return l}}},g=async()=>{try{const i=await(await fetch(`https://virtualpinballspreadsheet.github.io/vps-db/lastUpdated.json?&ts=${new Date().getTime()}`)).json();return new Date(i).getTime()}catch{return 0}},K={fetchDb:_,getGameImage:E,getGame:P,lastUpdated:v,dbStore:n,dbStoreOriginal:A,findRom:R,findFile:M};export{z as B,K as D,Q as E,x as T,J as a,X as b,U as c,W as d,k as e,I as f,L as g,H as h,N as i,C as j};
