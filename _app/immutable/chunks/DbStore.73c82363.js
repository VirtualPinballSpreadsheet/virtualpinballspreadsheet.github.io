import{w as A}from"./index.6e379fdf.js";import{a1 as d}from"./scheduler.a453f4b8.js";import{l as B}from"./ProgressBar.svelte_svelte_type_style_lang.c6c4a621.js";import"./index.fa05b556.js";const v="https://virtualpinballspreadsheet.github.io/vps-db/",O=v+"db/vpsdb.json";v+`lastUpdated.json?ts=${new Date().getTime()}`;const z="VirtualPinballSpreadsheet",H="vps-db",I="img/",x="games/",X="staging",T=["tableFiles","povFiles","b2sFiles","romFiles","altColorFiles","altSoundFiles","pupPackFiles","wheelArtFiles","topperFiles","mediaPackFiles","ruleFiles","tutorialFiles"],g=["Hybrid","VR","Mixed Reality","FSS","4k","MOD","Retheme","VPU Patch","FastFlips","SSF","P-ROC","FlexDMD","Music","incl. B2S","incl. ROM","incl. nvram","incl. Art","incl. PuP","incl. Video","no ROM","Kids","Adult","nFozzy","Fleep","VLM","LUT","Scorbit","BAM","FizX","DOF"],U=["2Screens","3Screens","FullDMD","incl. Table"],J=g.map(e=>({label:e,value:e})),Q=U.map(e=>({label:e,value:e})),W={id:"",authors:[],tableFormat:"VPX",urls:[],updatedAt:0},_={id:"",updatedAt:0,manufacturer:"",name:"???",year:0},K={authors:[],id:"",updatedAt:0,urls:[]},q={authors:[],id:"",updatedAt:0,title:"",youtubeId:"dQw4w9WgXcQ"},Y={authors:[],id:"",updatedAt:0,urls:[]},c=A({}),y=A({}),w=B("lastUpdatedDb",0),E=async()=>{try{const e=await C(),a={};(await(await fetch(O+`?&ts=${new Date().getTime()}`)).json()).forEach(i=>{const l=i.id;a[l]=i}),w.set(e),console.log("SET DB STORE"),c.set(a),y.set(JSON.parse(JSON.stringify(a)))}catch(e){console.log(e)}},P=e=>{var t,i;const s=d(c)[e];if(s){if(s.imgUrl)return s.imgUrl;if((t=s.b2sFiles)!=null&&t.length&&s.b2sFiles[0].imgUrl)return s.b2sFiles[0].imgUrl;if((i=s.tableFiles)!=null&&i.length&&s.tableFiles[0].imgUrl)return s.tableFiles[0].imgUrl}},M=e=>{const a=d(c);if(a[e])return a[e];let s=_;return Object.values(a).forEach(t=>{var i,l,n,r,u,m,f,p,F,b,h,D;(i=t.tableFiles)!=null&&i.some(o=>o.id===e)&&(s=t),(l=t.b2sFiles)!=null&&l.some(o=>o.id===e)&&(s=t),(n=t.romFiles)!=null&&n.some(o=>o.id===e)&&(s=t),(r=t.povFiles)!=null&&r.some(o=>o.id===e)&&(s=t),(u=t.altColorFiles)!=null&&u.some(o=>o.id===e)&&(s=t),(m=t.altSoundFiles)!=null&&m.some(o=>o.id===e)&&(s=t),(f=t.pupPackFiles)!=null&&f.some(o=>o.id===e)&&(s=t),(p=t.wheelArtFiles)!=null&&p.some(o=>o.id===e)&&(s=t),(F=t.mediaPackFiles)!=null&&F.some(o=>o.id===e)&&(s=t),(b=t.topperFiles)!=null&&b.some(o=>o.id===e)&&(s=t),(h=t.soundFiles)!=null&&h.some(o=>o.id===e)&&(s=t),(D=t.ruleFiles)!=null&&D.some(o=>o.id===e)&&(s=t)}),s},R=e=>{var t,i;const a=d(c),s=a[e];if(s)return s;for(const l of Object.values(a))if(((t=l.romFiles)==null?void 0:t.find(r=>r.version===e))||(i=l.tableFiles)!=null&&i.some(r=>r.id===e))return l;return null},j=(e,a)=>{const s=d(c);for(const t of Object.values(s)){const i=t[a];if(Array.isArray(i)){const l=i.find(n=>n.id===e);if(l)return l}}},S=e=>e.toLowerCase().replace(/[^a-z0-9]/g,""),$=e=>T.flatMap(a=>e[a]??[]),G=e=>{const a=d(c),s=S(e),t=new Map;for(const n of Object.values(a))for(const r of $(n))for(const u of r.authors??[])S(u).includes(s)&&t.set(u,(t.get(u)??0)+1);let i,l=0;for(const[n,r]of t)r>l&&(i=n,l=r);return i??e},C=async()=>{try{const a=await(await fetch(`https://virtualpinballspreadsheet.github.io/vps-db/lastUpdated.json?&ts=${new Date().getTime()}`)).json();return new Date(a).getTime()}catch{return 0}},Z={fetchDb:E,getGameImage:P,getGame:M,lastUpdated:w,dbStore:c,dbStoreOriginal:y,findRom:R,findFile:j,findAuthor:G};export{Q as B,Z as D,q as E,J as T,K as a,W as b,_ as c,Y as d,z as e,T as f,H as g,X as h,I as i,x as j};
